<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Video Test</title>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">
        <script src="https://cdn.plyr.io/3.6.4/plyr.polyfilled.js"></script>
        <link rel="stylesheet" href="https://cdn.plyr.io/3.6.4/plyr.css" />
        <style>
            .container {
                margin: 20px auto;
                width: 600px;
            }
            video {
                width: 100%;
            }
        </style>
    <body>
        <div class="container">
            <video controls crossorigin playsinline>
                <source src="https://cdn.samyofox.ninja/test2/get.m3u8" type="application/x-mpegURL"/>
            </video>
        </div>
        <script src="https://cdn.rawgit.com/video-dev/hls.js/18bb552/dist/hls.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const video = document.querySelector("video");
                const source = video.getElementsByTagName("source")[0].src;
                
                // For more options see: https://github.com/sampotts/plyr/#options
                // captions.update is required for captions to work with hls.js
                const defaultOptions = {};

                if (Hls.isSupported()) {
                    // For more Hls.js options, see https://github.com/dailymotion/hls.js
                    const hls = new Hls();
                    hls.loadSource(source);

                    // From the m3u8 playlist, hls parses the manifest and returns
                    // all available video qualities. This is important, in this approach,
                    // we will have one source on the Plyr player.
                    hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {

                    // Transform available levels into an array of integers (height values).
                    const availableQualities = hls.levels.map((l) => l.height)

                    // Add new qualities to option
                    defaultOptions.quality = {
                        default: availableQualities[0],
                        options: availableQualities,
                        // this ensures Plyr to use Hls to update quality level
                        forced: true,        
                        onChange: (e) => updateQuality(e),
                    }

                    // Initialize here
                    const player = new Plyr(video, defaultOptions);
                    });
                    player.source = {
                        type: 'video',
                        title: 'Paul',
                        sources: [
                            {
                                src: '7e0191083d434b70b37c3fd4cfa9257b.m3u8',
                                type: 'application/x-mpegURL',
                                size: 480
                            },
                            {
                                src: '66bfe9cdf420422ba4b94f8306d7be91.m3u8',
                                type: 'application/x-mpegURL',
                                size: 720
                            },
                            {
                                src: '1f24a76c8c474271bf4a96ffa0c9a27d.m3u8',
                                type: 'application/x-mpegURL',
                                size: 1080
                            },
                            
                        ]
                    }
                    hls.attachMedia(video);
                    window.hls = hls;
                } else {
                    // default options with no quality update in case Hls is not supported
                    const player = new Plyr(video, defaultOptions);
                }

                function updateQuality(newQuality) {
                    window.hls.levels.forEach((level, levelIndex) => {
                    if (level.height === newQuality) {
                        console.log("Found quality match with " + newQuality);
                        window.hls.currentLevel = levelIndex;
                    }
                    });
                }
                });

        </script>
    </body>
</html>
